
---
title: '西安电信一码通项目此前报道中提到「两天两夜把 1m 图片优化到100kb」，图像压缩技术难度是怎样的？'
categories: 
 - 社交媒体
 - 知乎
 - 知乎热榜
headimg: 'https://picsum.photos/400/300?random=1807'
author: 知乎
comments: false
date: Wed, 05 Jan 2022 23:24:31 GMT
thumbnail: 'https://picsum.photos/400/300?random=1807'
---

<div>   
不辣的皮皮的回答<br><br><p data-pid="hTrxEH3d">嗯，作为互联网人说几句吧。怎么说呢，大概有这么几个槽点：</p><p><br></p><p data-pid="SiQseWYv"><b>1 图像压缩不是什么难的技术</b></p><p data-pid="hFXpPtyY">首先我们要确定这个图片是否可以被压缩。如果此处指的是一码通的二维码，那显然可以被压缩（因为二维码的分辨率并不需要很高）；如果指的是广告位图片或者logo，都这时候了把这种图片干掉不更好么？</p><p data-pid="xIr40ERv">如果你自己打开电脑的画图板，将一张图片分辨率缩小，或者把图片从bmp转换为png jpg，这并不算是很难的事情；并且你会发现，二维码这么大的图片确实应该需要不到50k就可以了。</p><p><br></p><p data-pid="vYhfqg_8"><b>2 二维码图片应该在客户端生成，服务端应该只需要发送字符串给客户端</b></p><p data-pid="mQTolKhJ">这是更加需要吐槽的地方。二维码字符串应该在服务端生成，这样传送给客户端时，实际响应请求大小应该是1k级别的。</p><p data-pid="n_3hVGFz">客户端生成二维码的库应该是现成的。</p><p data-pid="EAD0EeT6">所以我有点怀疑，原文里面说的真的是二维码吗？真的像是广告位或者logo图。</p><p><br></p><p data-pid="sbf2nsKB"><b>3 一码通崩溃的根因？</b></p><p data-pid="wrBytRn5">我们可以这样理解网络请求，一类是占用较大带宽的（例如视频，图片，直播），另一类是占用较大计算资源（例如生成实时的二维码）。</p><p data-pid="42dT32ZU">这两类的优化思路完全不同，文中说的针对的是前一类的优化。</p><p data-pid="yzbdCCHC">我们假设西安1000w人口，有400w人需要在1小时内使用一码通。平均qps是1k，峰值期间假设突发10倍，也就是10k qps；按照文中图片压缩到100k来说，峰值带宽为1G。</p><p data-pid="cheepIZn">怎么说呢，我的感受是10k qps的计算压力更大一些；在图片优化之前，带宽压力是10G，容量较小的机房确实有可能顶不住，但是大机房基本没问题（当然前提是你有足够的分发服务，比如nginx）。</p><p><br></p><p data-pid="bcKhHIkm"><b>4 缺少性能测试和容量评估</b></p><p data-pid="tQ4_r9Uo">重要的事情说三遍，性能测试！性能测试！性能测试！</p><p data-pid="uiPqf8cH">不过抛开技术来说，这里更有可能的是一个配合问题。即运营提出了大家集中使用一码通的要求，但这个诉求和风险并没有传递给技术人员，从而没有对此时系统所需的容量进行评估。</p><p data-pid="N3fsLClJ">换句话来说，可能并不是没做性能测试，而是根本不知道自己要面对的压力是有多大。</p><p><br></p><p data-pid="3TLIbBEM">当然，以上基本属于我的猜测，实际情况可能并不是这样，估计我们也是无从得知了。</p>  
</div>
            