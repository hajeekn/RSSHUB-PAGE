
---
title: '让全世界大厂都手忙脚乱的代码漏洞，是怎么一步步成为噩梦的？'
categories: 
 - 新媒体
 - ZAKER
 - channel
headimg: 'https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202112/61baa17fb15ec018110d446e_1024.jpg'
author: ZAKER
comments: false
date: Wed, 15 Dec 2021 19:27:24 GMT
thumbnail: 'https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202112/61baa17fb15ec018110d446e_1024.jpg'
---

<div>   
<p>最近几天，世超在各家互联网大厂的程序员朋友们，都快被一个叫 Log4Shell 的史诗级漏洞给折磨疯了！</p><p>这个漏洞源于一个叫 Log4J2 （ Log For Java 2 ）的 Java 开源日志框架，它在用 Java 敲代码的码农群体里可以说是无人不知，无人不晓。</p><p></p><div class="img_box" id="id_imagebox_0" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_0" data-original="http://zkres2.myzaker.com/202112/61baa17fb15ec018110d446e_1024.jpg" data-height="271" data-width="512" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202112/61baa17fb15ec018110d446e_1024.jpg" referrerpolicy="no-referrer"></div></div>它就好像早年间打《 魔兽世界 》一定要装的大脚插件一样，属于真正意义上的<strong> " 咖啡伴侣 " </strong>，很少有 Java 程序不用这个组件。<p></p><p></p><div class="img_box" id="id_imagebox_1" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_1" data-original="http://zkres2.myzaker.com/202112/61baa17fb15ec018110d446f_1024.jpg" data-height="500" data-width="500" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202112/61baa17fb15ec018110d446f_1024.jpg" referrerpolicy="no-referrer"></div></div><strong>就是这么一个要命的底层日志框架，被发现透了一个洞。。。</strong><p></p><p>最先发现漏洞的，是阿里云安全团队中，一位叫 Chen Zhaojun 的大佬。</p><p>据他的说法，这个漏洞很早就被国外的安全代码扫描平台扫出来了，圈内的程序员大佬们也都在等待官方的修复，没有声张。</p><p>" 上百万刀的安全架构，在 Log4J2 漏洞面前一文不值。。。 " ▼</p><p></p><div class="img_box" id="id_imagebox_2" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_2" data-original="http://zkres2.myzaker.com/202112/61baa17fb15ec018110d4470_1024.jpg" data-height="608" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202112/61baa17fb15ec018110d4470_1024.jpg" referrerpolicy="no-referrer"></div></div>很快啊，包括了<strong>阿里、腾讯、百度、网易、新浪</strong>等一众国内的互联网大厂纷纷中枪，都被圈在了受影响的范围之内。<p></p><p>有博主还收到了腾讯云发来的防护短信。 ▼</p><p></p><div class="img_box" id="id_imagebox_3" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_3" data-original="http://zkres2.myzaker.com/202112/61baa17fb15ec018110d4471_1024.jpg" data-height="660" data-width="750" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202112/61baa17fb15ec018110d4471_1024.jpg" referrerpolicy="no-referrer"></div></div>不仅仅是大厂的服务系统，<strong>耳机、电脑、车机</strong>等硬件系统等也无一幸免。。。<p></p><p></p><div class="img_box" id="id_imagebox_4" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_4" data-original="http://zkres1.myzaker.com/202112/61baa17fb15ec018110d4472_1024.jpg" data-height="392" data-width="783" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202112/61baa17fb15ec018110d4472_1024.jpg" referrerpolicy="no-referrer"></div></div>不夸张的说，这个漏洞要是不及时修补，下场就是被如饥似渴的黑客们捅烂，进一步威胁网络安全。<p></p><p>他们会有效利用<strong> " 零日漏洞 " </strong>（ 指的是发现后立即被恶意利用的安全漏洞 ）发动零时差攻击，抢在安全补丁出来之前，对服务器造成杀伤。</p><p></p><div class="img_box" id="id_imagebox_5" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_5" data-original="http://zkres2.myzaker.com/202112/61baa17fb15ec018110d4473_1024.jpg" data-height="936" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202112/61baa17fb15ec018110d4473_1024.jpg" referrerpolicy="no-referrer"></div></div>就连我们日常使用的<strong>手机、电脑软件</strong>（ 大部分都是拿 Java 写的 ），也都将暴露在黑客的的攻击范围内，想捅哪里捅哪里，把你的电脑挟持过来挖矿也不是没可能。<p></p><p><strong>就和打游戏偷家似的， so easy 。。。</strong></p><p>不过有意思的是，也有乐子人利用这个漏洞，发现了特斯拉把国内数据上传到美利坚服务器的尴尬事儿。</p><p></p><div class="img_box" id="id_imagebox_6" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_6" data-original="http://zkres1.myzaker.com/202112/61baa17fb15ec018110d4474_1024.jpg" data-height="558" data-width="640" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202112/61baa17fb15ec018110d4474_1024.jpg" referrerpolicy="no-referrer"></div></div>不知道这个数据有没有包含用户数据，但我建议龙马哥先别急着解释这茬了，还是赶紧把这个漏洞修修吧，不然到时候可能真的不好收场。<p></p><p></p><div class="img_box" id="id_imagebox_7" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_7" data-original="http://zkres1.myzaker.com/202112/61baa17fb15ec018110d4475_1024.jpg" data-height="779" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202112/61baa17fb15ec018110d4475_1024.jpg" referrerpolicy="no-referrer"></div></div><strong>咳咳，扯远了。。。</strong><p></p><p>说回这次的漏洞，最可怕的地方在于实现起来没什么门槛，只要用一串简单的字符，就能轻易攻破服务器，并在上面运行各种代码。。。</p><p>这别说是窃取个人信息了，黑客想要远程挟持、瘫痪企业级的服务器，那也是毫无阻碍。</p><p>那黑客到底是怎么样利用漏洞，用几串字符就轻松攻破服务器的呢？</p><p></p><div class="img_box" id="id_imagebox_8" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_8" data-original="http://zkres2.myzaker.com/202112/61baa17fb15ec018110d4476_1024.jpg" data-height="464" data-width="459" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202112/61baa17fb15ec018110d4476_1024.jpg" referrerpolicy="no-referrer"></div></div><strong>要整明白这个问题，我们得先搞清楚啥是日志。</strong><p></p><p>众所周知啊，程序员在敲完一段代码之后，肯定不可能马上拿来用，而要通过反复的测试来验证代码的可行性。</p><p></p><div class="img_box" id="id_imagebox_9" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_9" data-original="http://zkres2.myzaker.com/202112/61baa17fb15ec018110d4477_1024.jpg" data-height="608" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202112/61baa17fb15ec018110d4477_1024.jpg" referrerpolicy="no-referrer"></div></div>但代码本身在跑的时候，处于一个黑箱状态，如果放任它瞎跑的话，跑到一半卡住，根本不知道是错在哪一步上。<p></p><p>这就好像是做数学题时候如果没草稿纸，在心里算总是没个底。</p><p>这时候，日志的作用就体现出来了，它就好像是一大张草稿纸，能在上面做任何你自己看的懂得步骤和标记，方便随时随地验算。</p><p><strong>本质上日志是程序员们经常使用的一个工具，它把代码在测试过程中的每一步都给记录下来，跑完再回头 Debug 的时候，就很有针对性，效率也高。</strong></p><p></p><div class="img_box" id="id_imagebox_10" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_10" data-original="http://zkres2.myzaker.com/202112/61baa17fb15ec018110d4478_1024.jpg" data-height="236" data-width="551" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202112/61baa17fb15ec018110d4478_1024.jpg" referrerpolicy="no-referrer"></div></div>而 Log4J2 ，就是这么一个开源的日志框架，它里面整合了不少在修改代码时会用到的常用功能，比如<strong>日志管理、输出变量</strong>等实用功能。<p></p><p></p><div class="img_box" id="id_imagebox_11" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_11" data-original="http://zkres2.myzaker.com/202112/61baa17fb15ec018110d4479_1024.jpg" data-height="640" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202112/61baa17fb15ec018110d4479_1024.jpg" referrerpolicy="no-referrer"></div></div><strong>这次的高危漏洞就是源于 Log4J2 中一个叫 Lookups 的功能。</strong><p></p><p>从字面上理解，这个功能就是一个用来搜索内容的接口，想要搜些啥，那就要靠代码去实现了。</p><p></p><div class="img_box" id="id_imagebox_12" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_12" data-original="http://zkres2.myzaker.com/202112/61baa17fb15ec018110d447a_1024.jpg" data-height="525" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202112/61baa17fb15ec018110d447a_1024.jpg" referrerpolicy="no-referrer"></div></div>Log4J2 也在 Lookups 的功能下，提供了不少实现的途径，问题就出在这个叫 JNDI 的途径上。<p></p><p></p><div class="img_box" id="id_imagebox_13" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_13" data-original="http://zkres1.myzaker.com/202112/61baa17fb15ec018110d447b_1024.jpg" data-height="665" data-width="504" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202112/61baa17fb15ec018110d447b_1024.jpg" referrerpolicy="no-referrer"></div></div>JNDI 被 Java 允许通过远程连接的方式来加载文件，这个远程地址可以是开发者自己的服务器，也可以是外界的服务器。<p></p><p></p><div class="img_box" id="id_imagebox_14" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_14" data-original="http://zkres1.myzaker.com/202112/61baa17fb15ec018110d447d_1024.jpg" data-height="575" data-width="1024" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202112/61baa17fb15ec018110d447d_1024.jpg" referrerpolicy="no-referrer"></div></div><strong>坏就坏在这个远程下载上了。。。</strong><p></p><p>黑客只要通过 JNDI 的方法连接上自己的恶意服务器，就可以堂而皇之从这个接口进来，继而攻破整栋固若金汤的大厦。</p><p></p><div class="img_box" id="id_imagebox_15" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_15" data-original="http://zkres2.myzaker.com/202112/61baa17fb15ec018110d447e_1024.jpg" data-height="692" data-width="1024" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202112/61baa17fb15ec018110d447e_1024.jpg" referrerpolicy="no-referrer"></div></div>这里世超用尽可能简单的说法解释了一下这个漏洞，如果差友们对具体的实现方式有兴趣，可以看下知乎上轩辕之风大佬写的这篇文章，介绍的很详尽了。<p></p><p><strong>https : //zhuanlan.zhihu.com/p/444103520 </strong></p><p>那么问题来了，为什么这个漏洞在被发现之后过了这么久，才被重视起来？</p><p><strong>外行看热闹，内行看门道，有些事儿还真得问问业内人士。</strong></p><p>于是世超咨询了国内知名的白帽网站——<strong>火线安全平台</strong>的小火子同学，聊了一通之后，大致了解了专业人士对这件事儿的看法。</p><p></p><div class="img_box" id="id_imagebox_16" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_16" data-original="http://zkres1.myzaker.com/202112/61baa17fb15ec018110d447f_1024.jpg" data-height="378" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202112/61baa17fb15ec018110d447f_1024.jpg" referrerpolicy="no-referrer"></div></div>实际上 Log4J2 漏洞产生的原因，是因为部分程序员想要开发者保留在 Lookups 中 JNDI 的实现方式的旧功能而引起的。<p></p><p>根据 Log4J2 的维护者 Volkan Yaz c 的说法，他们早就想把这个有风险的功能给去了，但为了保证向后的兼容性，照顾到想要用这个功能的程序员，所以还是保留了下来。</p><p></p><div class="img_box" id="id_imagebox_17" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_17" data-original="http://zkres1.myzaker.com/202112/61baa17fb15ec018110d4480_1024.jpg" data-height="655" data-width="742" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202112/61baa17fb15ec018110d4480_1024.jpg" referrerpolicy="no-referrer"></div></div><strong>好嘛，小洞不补、大洞吃苦，</strong>这个高危漏洞被发现之后， Log4J2 实际的管理机构 Apache 软件基金会并没能引起足够的重视，披露漏洞的流程也没有按流程来走。<p></p><p></p><div class="img_box" id="id_imagebox_18" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_18" data-original="http://zkres2.myzaker.com/202112/61baa17fb15ec018110d4481_1024.jpg" data-height="675" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202112/61baa17fb15ec018110d4481_1024.jpg" referrerpolicy="no-referrer"></div></div>他们直接把问题往开源平台 Github 的 issue 里一贴，期待能有好心人给出解决问题得方案。<p></p><p><strong>但这是个开放平台啊，有程序员同样也有客。。。</strong></p><p>这波操作等于告诉了全世界的黑客：<strong> " 咱这软件有高危漏洞哈，欢迎来捅！ " </strong></p><p></p><div class="img_box" id="id_imagebox_19" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_19" data-original="http://zkres1.myzaker.com/202112/61baa17fb15ec018110d4482_1024.jpg" data-height="839" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202112/61baa17fb15ec018110d4482_1024.jpg" referrerpolicy="no-referrer"></div></div>甚至在漏洞全面爆发之前，就已经有白客们在 issue 中公开讨论过具体的修复细节。<p></p><p></p><div class="img_box" id="id_imagebox_20" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_20" data-original="http://zkres1.myzaker.com/202112/61baa17fb15ec018110d4483_1024.jpg" data-height="695" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202112/61baa17fb15ec018110d4483_1024.jpg" referrerpolicy="no-referrer"></div></div>可惜的是，等到所有用到使用 Log4J2 的业务系统反应过来有这个漏洞，已经过去了很长一段时间了。<p></p><p>因为使用 Log4J2 组件的软件实在太多，所以<strong>互联网公司的安全部门要一个个软件做修复和升级，这里头的工作量也可想而知。</strong></p><p>目前最快的临时处理方案，是在 Log4J2 做一个触发式的拦截程序，类似于给系统先打上疫苗，把与漏洞相关内容，提前进行阻拦，和防火墙的原理差不多。</p><p>话说回来，世超觉得引发这次漏洞问题的锅，也不应该全由 Log4J2 的维护者来背。</p><p>说出来你可能不信，<strong>像 Log4J2 这么大一个开源项目，实际只靠几个程序员在业余时间来管理和维护，他们本身也是用爱发电，没有任何报酬的。</strong></p><p><strong>来自 Volkan Yaz c 推特下网友们的评论▼</strong></p><p></p><div class="img_box" id="id_imagebox_21" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_21" data-original="http://zkres1.myzaker.com/202112/61baa17fb15ec018110d4484_1024.jpg" data-height="762" data-width="600" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202112/61baa17fb15ec018110d4484_1024.jpg" referrerpolicy="no-referrer"></div></div>与之相反的是，包括像<strong>苹果、谷歌、亚马逊、特斯拉</strong>在内的这些大公司，都一定程度上在开心的<strong> " 白嫖 " </strong>Log4J2 ，毕竟开源嘛，能省一点人力维护就省一点，反正总会有人维护的。。。<p></p><p>对于大厂开发者来说，这个来自十几年前仅有数人在维护的工具，只要能够完成产品，那凑合用就凑合用了，绝不重复造轮子。</p><p>并且争取在出现问题之前，成功跳槽。。。</p><p>可想而知，人人对于这类程序安全漏洞始终都是<strong> " 碰到了才明白出了问题 "</strong>，谁知道整个行业都翻了车。</p><p></p><div class="img_box" id="id_imagebox_22" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_22" data-original="http://zkres1.myzaker.com/202112/61baa17fb15ec018110d4485_1024.jpg" data-height="404" data-width="610" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202112/61baa17fb15ec018110d4485_1024.jpg" referrerpolicy="no-referrer"></div></div>尽管事儿已经是告一段落了，但这样大型的漏洞翻车事件，并不是第一次，也不会是最后一次发生，此类的<strong> " 黑天鹅事件 " </strong>，往往是不可预估且偶发性的。<p></p><p>而这一场场在网络世界中燃起的大火，唯有依靠程序员们的挑灯夜战，才得以熄灭。。。</p><div id="recommend_bottom"></div><div id="article_bottom"></div>  
</div>
            