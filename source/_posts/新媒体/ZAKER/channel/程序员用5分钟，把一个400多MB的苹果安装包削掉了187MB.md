
---
title: '程序员用5分钟，把一个400多MB的苹果安装包削掉了187MB'
categories: 
 - 新媒体
 - ZAKER
 - channel
headimg: 'https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202202/6219bcdb8e9f09233d2b0dff_1024.jpg'
author: ZAKER
comments: false
date: Fri, 25 Feb 2022 22:19:00 GMT
thumbnail: 'https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202202/6219bcdb8e9f09233d2b0dff_1024.jpg'
---

<div>   
<p>前些日子，一个<strong>手机 QQ 安装包</strong>就要<strong>快 900MB</strong>的事儿在网上吵得沸沸扬扬。</p><p><strong></strong></p><div class="img_box" id="id_imagebox_0" onclick><div class="content_img_div perview_img_div"><strong><img class="lazy opacity_0 " id="img_0" data-original="http://zkres1.myzaker.com/202202/6219bcdb8e9f09233d2b0dff_1024.jpg" data-height="847" data-width="828" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202202/6219bcdb8e9f09233d2b0dff_1024.jpg" referrerpolicy="no-referrer"></strong></div></div><strong>△</strong> 最新安装包又大了，已经 924MB<p></p><p>虽然最后大家发现它主要为了视频通话特效多了一个<strong>虚幻引擎</strong>，但网友还是感叹：</p><p>现在的 App 真的是越来越大了。</p><p></p><div class="img_box" id="id_imagebox_1" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_1" data-original="http://zkres1.myzaker.com/202202/6219bcdb8e9f09233d2b0e00_1024.jpg" data-height="500" data-width="504" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202202/6219bcdb8e9f09233d2b0e00_1024.jpg" referrerpolicy="no-referrer"></div></div>而就在最近，<strong>国外一位程序员</strong>也遇到了同样的困惑。<p></p><p>他乘的一班飞机由于没有机上小电视，只能下载一个叫做<strong>" 美联航 "</strong>的 App 来看视频打发时间。</p><p>小哥一边感叹现在航空公司越来越鸡贼：把成本都加到顾客头上，一边打开了应用商店，结果就很诧异：</p><p>不就用来看个电影啥的吗，<strong>一个 Netflix 都只有 101.5MB，这 App 怎么是它的四倍</strong>？</p><p></p><div class="img_box" id="id_imagebox_2" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_2" data-original="http://zkres2.myzaker.com/202202/6219bcdb8e9f09233d2b0e01_1024.jpg" data-height="800" data-width="370" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202202/6219bcdb8e9f09233d2b0e01_1024.jpg" referrerpolicy="no-referrer"></div></div>作为一名<strong>iOS/Android 开发工程师</strong>，小哥决定不 " 坐以待毙 "，看看它是否真的需要这么大的空间。<p></p><p><b>原来可以省掉 187MB</b></p><p>说干就干，还在飞机上的小哥立刻用<strong>ipatool</strong>下载了这个 App 的二进制文件。</p><p>ipatool 是 GitHub 上标星 1.4k 的开源项目，是一个命令行工具，可以从 iOS 应用商店搜索和下载应用程序的 ipa 文件包，用这个包可以进行开发内容的一些检查等功能。</p><p></p><div class="img_box" id="id_imagebox_3" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_3" data-original="http://zkres1.myzaker.com/202202/6219bcdb8e9f09233d2b0e02_1024.jpg" data-height="758" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202202/6219bcdb8e9f09233d2b0e02_1024.jpg" referrerpolicy="no-referrer"></div></div>下好以后需要把 ipa 扩展名改为 zip，解压之后可以看到下面这样的目录：<p></p><p></p><div class="img_box" id="id_imagebox_4" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_4" data-original="http://zkres1.myzaker.com/202202/6219bcdb8e9f09233d2b0e03_1024.jpg" data-height="768" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202202/6219bcdb8e9f09233d2b0e03_1024.jpg" referrerpolicy="no-referrer"></div></div>可以发现 Frameworks 就占了 414.8MB，小哥解释：应用程序的主要内存来源就是 Frameworks，现在的最佳实践都是把代码 push 到这里面，还是挺正常的。<p></p><p>接下来进入该目录：</p><p></p><div class="img_box" id="id_imagebox_5" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_5" data-original="http://zkres1.myzaker.com/202202/6219bcdb8e9f09233d2b0e04_1024.jpg" data-height="824" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202202/6219bcdb8e9f09233d2b0e04_1024.jpg" referrerpolicy="no-referrer"></div></div>以 UAL 开头的框架是核心架构、NodeMobile 框架跟 NodeJS 功能有关、LocusLabsSDK 和 Mapbox 是供应地图的，还有一些是负责身份验证、客户反馈的……<p></p><p>而视频播放相关的框架相反其实占内存并不多：</p><p></p><div class="img_box" id="id_imagebox_6" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_6" data-original="http://zkres2.myzaker.com/202202/6219bcdb8e9f09233d2b0e05_1024.jpg" data-height="693" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202202/6219bcdb8e9f09233d2b0e05_1024.jpg" referrerpolicy="no-referrer"></div></div>接着进入占空间最大的 UALAppCore.framework。<p></p><p>经过层层探索，小哥终于在这里锁定了最大占存的 UALAppCore。</p><p></p><div class="img_box" id="id_imagebox_7" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_7" data-original="http://zkres1.myzaker.com/202202/6219bcdb8e9f09233d2b0e06_1024.jpg" data-height="525" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202202/6219bcdb8e9f09233d2b0e06_1024.jpg" referrerpolicy="no-referrer"></div></div>按照他的工作经验，77MB 这个数字还是有点反常的，他打算用 nm 命令深入看看这个框架的符号表（symbol）文件（nm 用于显示二进制目标文件的符号表，格式如下）。<p></p><p></p><div class="img_box" id="id_imagebox_8" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_8" data-original="http://zkres2.myzaker.com/202202/6219bcdb8e9f09233d2b0e07_1024.jpg" data-height="433" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202202/6219bcdb8e9f09233d2b0e07_1024.jpg" referrerpolicy="no-referrer"></div></div>很快他就想起来，Swift 的符号需要<strong>剥离</strong>（strip，iOS 框架中的术语），Objective-C 则不需要。<p></p><p>那就查 Swift 的，结果还真就发现：</p><p>没有一个 Swift 框架的符号被剥离过。</p><p>而这些都没有用，白白耗内存：</p><p></p><div class="img_box" id="id_imagebox_9" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_9" data-original="http://zkres1.myzaker.com/202202/6219bcdb8e9f09233d2b0e08_1024.jpg" data-height="275" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202202/6219bcdb8e9f09233d2b0e08_1024.jpg" referrerpolicy="no-referrer"></div></div>那接下来就简单了，写一个 bash 脚本运行一下该框架就可以 OK：<p></p><p></p><div class="img_box" id="id_imagebox_10" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_10" data-original="http://zkres1.myzaker.com/202202/6219bcdb8e9f09233d2b0e09_1024.jpg" data-height="670" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202202/6219bcdb8e9f09233d2b0e09_1024.jpg" referrerpolicy="no-referrer"></div></div>最后，可以看到原始框架从 350MB 减到了 163M！<p></p><p></p><div class="img_box" id="id_imagebox_11" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_11" data-original="http://zkres1.myzaker.com/202202/6219bcdb8e9f09233d2b0e0a_1024.jpg" data-height="198" data-width="978" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202202/6219bcdb8e9f09233d2b0e0a_1024.jpg" referrerpolicy="no-referrer"></div></div>小哥表示，这一顿操作<strong>只花了不到 5 分钟</strong>，没想到可削减空间这么大，整整省掉了 187MB。<p></p><p>等于现在的安装包只有原来的<strong>不到 60% 了</strong>。</p><p>他猜测该安装包仍有削减空间，不过这个结果他已经很满意了。</p><p>你，学废了吗？</p><p><b>" 开发商才不关心呢 "</b></p><p>就在小哥发出这个博客之后，有网友评论道，还有很多安装包其实都可以再缩减 15% 到 30% 甚至更高的空间，就比如<strong>Gmail、Outlook</strong>这些很常见的应用。</p><p>但似乎现在很多<strong>开发商不是很关心这个问题</strong>，他们只想赶紧不停更新应用：</p><p>给不给用户省掉这几百 M 的流量都一样赚钱，为啥还要费功夫呢？</p><p></p><div class="img_box" id="id_imagebox_12" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_12" data-original="http://zkres2.myzaker.com/202202/6219bcdb8e9f09233d2b0e0b_1024.jpg" data-height="99" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202202/6219bcdb8e9f09233d2b0e0b_1024.jpg" referrerpolicy="no-referrer"></div></div>有一位嵌入式工程师就表示：当我跟同事提起要注意这方面的优化时，他们总是给我一个茫然的眼神。<p></p><p>有网友认为：除非<strong>各应用商店</strong>开始管这事儿，开发商是不会做出改变的。就单说手机厂商就很乐意看到这一场面，内存不够就可以去他们那买新手机了。</p><p></p><div class="img_box" id="id_imagebox_13" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_13" data-original="http://zkres1.myzaker.com/202202/6219bcdb8e9f09233d2b0e0c_1024.jpg" data-height="111" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202202/6219bcdb8e9f09233d2b0e0c_1024.jpg" referrerpolicy="no-referrer"></div></div>他还发现谷歌 Play Store 好像就不显示应用程序大小。<p></p><p>而一些<strong>银行 App</strong>在这个问题上尤其严重，因为他们知道你不会轻易换银行。</p><p>你怎么看？</p><div id="recommend_bottom"></div><div id="article_bottom"></div>  
</div>
            