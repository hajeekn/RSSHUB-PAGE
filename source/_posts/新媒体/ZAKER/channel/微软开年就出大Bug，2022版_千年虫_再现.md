
---
title: '微软开年就出大Bug，2022版_千年虫_再现'
categories: 
 - 新媒体
 - ZAKER
 - channel
headimg: 'https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202201/61d544388e9f0922e8234dc1_1024.jpg'
author: ZAKER
comments: false
date: Wed, 05 Jan 2022 02:15:00 GMT
thumbnail: 'https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202201/61d544388e9f0922e8234dc1_1024.jpg'
---

<div>   
<p>整理 | 于轩 </p><p>逢年过节卡点送祝福早已是常识，元旦，相信不少人都在卡点送祝福。零点一过，大批的祝福通过各种服务器送出，因此服务器的稳定运行是非常必要的。然而就在这个关键时刻，微软 Exchange 服务器却出了岔子。不少 Exchange 服务器的用户发现自己的祝福邮件没发出去，被留在了 2021 年。</p><p></p><div class="img_box" id="id_imagebox_0" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_0" data-original="http://zkres1.myzaker.com/202201/61d544388e9f0922e8234dc1_1024.jpg" data-height="473" data-width="851" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202201/61d544388e9f0922e8234dc1_1024.jpg" referrerpolicy="no-referrer"></div></div><strong> Windows 事件日志显示的错误提醒</strong><p></p><p>Exchange Server 是微软公司推出的一套电子邮件服务组件，可以被用来构架应用于企业、学校等团体机构的邮件系统。也可以用于开发工作流、知识管理系统、Web 系统或者是其他消息系统。</p><p>话说程序员不是在写 Bug 就是在改 Bug，就连新年也躲不过！Exchange 管理员被迫紧急加班。</p><p>他们调查发现，造成邮件无法发送的原因是 Microsoft Exchange 采用的邮件过滤管理系统（FIP-FS），采用了一种名叫 "yymmddHHMM" 的有符号变量（Int32，也就是 long）来存储日期。但是，因为该变量最多只能存储 -2,147,483,647 到 +2,147,483,647 的数据，而 2022 年 1 月 1 日午夜的新日期值为 2,201,010,001，超过了这个范围。所以，当 Microsoft Exchange 尝试检查 AV 扫描版本时，它生成了一个错误并导致恶意软件引擎崩溃，信息就被卡在了传输队列中。</p><p>巧的是，这次微软日期 bug 事件与 2000 年的 " 千年虫（Y2K）" 问题如出一辙，所以该故障被命名为 Y2K22（22 指的是 2022 年）。据微软称，该问题只影响配置了 FIP-FS 恶意软件引擎的 Microsoft Exchange 2016 和 2019 版本。如果用户已经禁用 FIP-FS 引擎，并使用其它的电子邮件拦截方案，那就不会受到影响，边缘传输服务器也一样。</p><p>幸运的是，Exchange 管理员已有对策，并发布了一个正式的修复方案，看来 Y2K22 危机已经结束。微软表示，客户可以通过自动或手动解决方案来解决这个问题。</p><p><strong>自动化解决方案：</strong></p><p></p><div class="img_box" id="id_imagebox_1" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_1" data-original="http://zkres2.myzaker.com/202201/61d544388e9f0922e8234dc2_1024.jpg" data-height="129" data-width="1008" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202201/61d544388e9f0922e8234dc2_1024.jpg" referrerpolicy="no-referrer"></div></div>在运行脚本之前，通过运行 Set-ExecutionPolicy -ExecutionPolicy RemoteSigned 更改 PowerShell 脚本的执行策略<p></p><p><strong>手动解决方案：</strong></p><p></p><div class="img_box" id="id_imagebox_2" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_2" data-original="http://zkres2.myzaker.com/202201/61d544388e9f0922e8234dc3_1024.jpg" data-height="495" data-width="1235" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202201/61d544388e9f0922e8234dc3_1024.jpg" referrerpolicy="no-referrer"></div></div><strong>验证受影响的版本是否已安装</strong><p></p><p>运行 Get-EngineUpdateInformation 并检查 UpdateVersion 信息。如果它以 "22... " 开头，则继续。如果安装的版本以 "21... " 开头，则不需要采取任何措施。</p><p><strong>删除现有的引擎和元数据</strong></p><p>1. 停止微软过滤管理服务。当提示您同时停止 Microsoft Exchange 传输服务时，请点击是。</p><p>2. 使用任务管理器以确保 updateservice.exe 没有运行。</p><p>3. 删除以下文件夹：%ProgramFiles%MicrosoftExchange ServerV15FIP-FSDataEnginesamd64Microsoft。4. 移除以下文件夹中的所有文件：%ProgramFiles%MicrosoftExchange ServerV15FIP-FSDataEnginesmetadata。</p><p><strong>更新到最新的引擎</strong></p><p>1. 启动 Microsoft 过滤管理服务和 Microsoft Exchange 传输服务。</p><p>2. 打开 Exchange 管理壳，导航到 Scripts 文件夹（%ProgramFiles%MicrosoftExchange ServerV15Scripts），并运行 Update-MalwareFilteringServer.ps1 。</p><p><strong>验证引擎更新信息</strong></p><p>1. 在 Exchange Management Shell 中，运行 Add-PSSnapin Microsoft.Forefront.Filtering.Management.Powershell。</p><p>2. 运行 Get-EngineUpdateInformation 并验证 UpdateVersion 信息为 2112330001（或更高）。</p><p>微软还建议用户在更新引擎后<strong>验证邮件流是否正常工作</strong>，并且应用程序事件日志中<strong>不存在 FIPFS 错误事件</strong>。</p><div id="recommend_bottom"></div><div id="article_bottom"></div>  
</div>
            